AWSTemplateFormatVersion: 2010-09-09
Description: |
  CloudFormation Template for Milliseconds Converter Application (Python Flask). This template
  creates Python Flask Web Application on Amazon Linux 2 (xxxxxxxxxxxx) EC2 Instance with
  custom security group allowing http connection on port 80.
  Milliseconds Converter Application (Python Flask) is downloaded from GitHub repository, then
  installed on Flask and deployed on AWS Application Load Balancer with Auto Scaling Group
  using AWS Cloudformation
Parameters:
  
  VPCId:
    Description: Please select your VPCId
    Type: AWS::EC2::VPC::Id
  
  Subnets:
    Description: Please select your SubnetIds.
    Type: List<AWS::EC2::Subnet::Id>
   
  KeyPair:
    Description: Please enter your KeyPair file.
    Type: AWS::EC2::KeyPair::KeyName
  
Resources:

  LoadBalancer:
    Type: "AWS::ElasticLoadBalancingV2::LoadBalancer"
    Properties:
      SecurityGroups:
        - !GetAtt SecGroup.GroupId
      SubnetMappings:
        - 
      Subnets:
        - String
      Tags:
        - Tag
      Type: String

  Listener:
    Type: "AWS::ElasticLoadBalancingV2::Listener"
    Properties:
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref TargetGroup
      LoadBalancerArn: !Ref LoadBalancer
      Port: 80
      Protocol: HTTP

  TargetGroup:
    Type: "AWS::ElasticLoadBalancingV2::TargetGroup"
    Properties:
      Port: 80
      Protocol: HTTP
      VpcId: !Ref VPCId

  SecGroup:
    Type: "AWS::EC2::SecurityGroup"
    Properties:
      GroupDescription: HTTP and SSH
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0

Outputs: